{% extends "console/base.html" %}
{% block content %}

<main class="content">

    <div class="container-fluid p-0">

        <div class="row mb-2 mb-xl-3">
            <div class="col-auto d-none d-sm-block">
                <h3><strong>Upload Users</strong></h3>
            </div>
            
            <div class="row">
                <div class="col-12">
                    <div class="card">
                      
                        <div class="card-body">


                            <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button"
                                aria-expanded="false" aria-controls="collapseExample">
                                Upload File
                            </a>
                            
                          {#  <button class="btn btn-success" onclick="getRoleExcel()"> Get Role Excel </button> #}

                            <div class="collapse mt-3" id="collapseExample">
                                <div class="card card-body">
                                    <div class="col-md-6">
                                        <div class="">
                                            <a href="/media/sample/users.xlsx" class="mt-2 pt-3">Download sample file</a>
                                            <div class="form-group mt-4">
                                                <label>Upload a File</label>
                                                <input id="fileupload"  type="file">
                                            </div>
                                        </div>

                                        <button type="button" onclick="uploadUsers()" id="form_button" class="btn btn-success mt-4">
                                            Upload
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                        </div>
                        <div class="card-body">

                         

                            <table class="table" id="table_enrollments" class="display">
                                <thead class="thead-white">
                                    <tr>
                                        
                                        <th scope="col">S. NO</th>
                                        <th> Total entries</th>
                                        <th scope="col">Total errors</th>
                                        <th scope="col">Is imported</th>

                                        <th scope="col">Created At</th>
                                        <th scope="col">Action</th>
                                        <th scope="col">Remove </th>


                                    </tr>
                                </thead>
                                <tbody>

                                  

                                    {% for user_upload_obj in user_upload_objs %}
                                   
                                    <tr>
                                      
                                        <td>{{forloop.counter}}</td>
                                        
                                        <td> {{user_upload_obj.total_entries}}</td>
                                        <td>

                                        <p onclick="getUserErrors('{{user_upload_obj.id}}')" data-toggle="tooltip" data-placement="right" title="Click to show errors"> {{user_upload_obj.total_errors}}</p>

                                        </td>
                                        <td>
                                            
                                            {{user_upload_obj.is_imported}}
                                           
                                        </td>
                                        
                                        <td>{{user_upload_obj.created_at|date:'d-M-Y g:H A'}}</td>
                                        

                                        <td>
                                            <button class="btn btn-info"  {% if user_upload_obj.total_errors != 0 or user_upload_obj.is_imported %} disabled {% endif%} onclick="importUser('{{user_upload_obj.id}}')">Import</button>
                                           
                                        </td>

                                        <td class="text-center">
                                            <a href="{% url 'remove_upload_user' user_upload_obj.id %}" class="btn btn-danger"><i class="fas fa-trash-alt"></i></a>
                                        </td>

                                    </tr>

                                    {% endfor %}



                                </tbody>
                            </table>




                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</main>






<style>
    .chip {
    display: inline-block;
    padding: 0 5px;
    height: 40px;
    font-size: 12px;
    line-height: 50px;
    border-radius: 25px;
    background-color: #f1f1f1;
  }
  </style>



<div class="modal fade" id="staticBackdrop" data-backdrop="static" tabindex="-1" role="dialog"
aria-labelledby="staticBackdropLabel" aria-hidden="true">
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="staticBackdropLabel">Please note down the errors page will be refreshed</h5>

    </div>
    <div class="modal-body">
      <div id="errors"></div>

    </div>
    <div class="modal-footer">

      <button type="button" onclick="window.location.reload()" data-dismiss="modal" class="btn btn-primary">Understood</button>
    </div>
  </div>
</div>
</div>



<div class="modal fade" id="exampleModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Create User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
    
                <div class="mb-3">
                  <label for="exampleInputEmail1" class="form-label">Email address</label>
                  <input type="email" id="email_id" readonly class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp">
                </div>

                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Emp Id</label>
                    <input type="email" id="emp_id" readonly class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp">
                  </div>

                  <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">User Type</label>
                  
                    <select class="form-control" id="user_type" onchange="showPermissions()">
                        <option value="1">Make admin</option>
                        <option value="2">Make Normal user</option>
                    </select>
                </div>

                <div class="mb-3" id="permissions" style="display:none">
                    <label for="exampleInputEmail1" class="form-label">Select Permission</label>
                  
                    <select class="form-control" id="permission" multiple >
                        {% for role in roles %}
                        <option value="{{role.id}}">{{role.role_name}}</option>
                        {% endfor %}
                    </select>
                </div>


               

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" onclick="updateUser()" class="btn btn-primary">Update</button>
        </div>
      </div>
    </div>
  </div>

  
  <div class="modal fade" id="uploadProgress" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Your file is getting uploaded</h5>
         
        </div>
        <div class="modal-body">
            <p id="progress_text"></p>
            <div class="progress">
                <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 0%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
        </div>
       
      </div>
    </div>
  </div>

  <script type="text/javascript">


</script>

{% endblock %}