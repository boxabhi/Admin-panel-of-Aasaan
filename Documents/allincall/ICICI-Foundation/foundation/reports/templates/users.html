{% extends "console/base.html" %}
{% block content %}



<main class="content">

    <div class="container-fluid p-0">

        <div class="row mb-2 mb-xl-3">
            <div class="col-auto d-none d-sm-block">
                <h3><strong>All Users Page</strong></h3>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                        </div>
                        <div class="card-body">

                            <a href="{% url 'enrollments' %}" class="btn btn-info mb-4"><i
                                    class="fas fa-arrow-left"></i></a>

                            <div class="text-right mb-4">

                                <button class="btn btn-success" onclick="downloadUserData()">Download</button>


                                {% for role in  request.user.profile.role.all %}
                                {% if role.role_name == 'create' %}
                                <!-- <button class="btn btn-danger" onclick="importTrainees()">Create User</button> -->
                                <button type="button" class="btn btn-info" data-bs-toggle="modal"
                                    data-bs-target="#createUserModal">
                                    Create User
                                </button>
                                {% endif %}
                                {% if role.role_name == 'delete' %}
                                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteUsers">
                                  Delete
                                  </button>
                          
                                {% endif %}
                                {% endfor %}
                            </div>

                            <table class="table" id="table_enrollments" class="display">
                                <thead class="thead-white">
                                    <tr>
                                        <th scope="col">
                                            <input id="checkbox" type="checkbox" onchange="checkBoxStatus()">
                                        </th>
                                        <th scope="col">S. NO</th>
                                        <th> Image</th>
                                        <th scope="col">User Email</th>
                                        <th scope="col">Emp Id</th>

                                        <th scope="col">Is Admin</th>
                                        <th scope="col">Permission</th>
                                        <th scope="col">Created On</th>
                                        <th scope="col">Last modified</th>

                                        <th scope="col">Is Active</th>

                                        <th scope="col">Action</th>


                                    </tr>
                                </thead>
                                <tbody>

                                    {% for user_obj in user_objs %}

                                    <tr>
                                        <td>
                                            <input type="checkbox" id="checkboxes" data-profile_id="{{user_obj.pk}}">
                                        </td>
                                        <td>{{forloop.counter}}</td>
                                        <td>
                                            {% if user_obj.profile_image %}
                                            <img src="{{user_obj.profile_image}}" class="rounded-circle"
                                                style="height:30px">
                                            {% else %}
                                            <img src="https://t4.ftcdn.net/jpg/00/64/67/63/360_F_64676383_LdbmhiNM6Ypzb3FM4PPuFP9rHe7ri8Ju.jpg"
                                                class="rounded-circle" style="height:30px">
                                            {% endif %}
                                        </td>
                                        <td>{{user_obj.email}}</td>
                                        <td>{{user_obj.emp_id}}</td>
                                        <td>
                                            {{user_obj.is_admin}}
                                        </td>
                                        <td>


                                            {% if user_obj.is_admin == 'Admin' %}

                                            <div class="chip">
                                                <div class="chip-content">All</div>
                                            </div>

                                            {% elif not user_obj.role.all %}
                                            No role assigned
                                            {% else %}
                                            {% for role in user_obj.role.all %}
                                            <div class="chip">
                                                <div class="chip-content">{{role}}</div>
                                            </div>

                                            {% endfor %}
                                            {% endif%}

                                        </td>
                                        <td>{{user_obj.date_joined |date:'d-M-Y g:H A'}}</td>
                                        <td>{{user_obj.updated_at|date:'d-M-Y g:H A'}}</td>

                                        <td class="text-center">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input"
                                                    onchange="toggleActive('{{user_obj.id}}')" type="checkbox"
                                                    id="flexSwitchCheckDefault" {% if user_obj.is_active %}
                                                    checked{% endif  %}>

                                            </div>



                                        </td>

                                        <td>
                                            <button class="btn btn-info"
                                                onclick="getUser('{{user_obj.id}}')">Update</button>

                                        </td>


                                    </tr>

                                    {% endfor %}



                                </tbody>
                            </table>




                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</main>








<div class="modal fade" id="createUserModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Create User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">First name</label>
                    <input type="text" id="first_name1"  class="form-control" id="exampleInputEmail1"
                        aria-describedby="emailHelp">
                </div>


                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Last name</label>
                    <input type="text" id="last_name1"  class="form-control" id="exampleInputEmail1"
                        aria-describedby="emailHelp">
                </div>

                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Emp Id</label>
                    <input type="text" id="email_id1"  class="form-control" id="exampleInputEmail1"
                        aria-describedby="emailHelp">
                </div>

                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Emp Id</label>
                    <input type="text" id="emp_id1"  class="form-control" id="exampleInputEmail1"
                        aria-describedby="emailHelp">
                </div>

                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">User Type</label>

                    <select class="form-control" id="user_type1" onchange="showPermissions()">
                        <option value="1">Admin</option>
                        <option value="2">Manager</option>
                    </select>
                </div>

                <div class="mb-3" id="permissions1" style="display:none">
                    <label for="exampleInputEmail1" class="form-label">Select Permission</label>

                    <select id="permission1" multiple data-style="bg-white rounded-pill px-4 py-3 shadow-sm "
                        class="selectpicker w-100">
                        {% for role in roles %}
                        <option value="{{role.id}}">{{role.role_name}}</option>
                        {% endfor %}
                    </select>
                </div>


                
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Address</label>
                    <input type="text" id="address1"  class="form-control" id="exampleInputEmail1"
                        aria-describedby="emailHelp">
                </div>



            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" onclick="createUser()" class="btn btn-primary">Create</button>
            </div>
        </div>
    </div>
</div>







<div class="modal fade" id="exampleModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Update User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Email address</label>
                    <input type="email" id="email_id" readonly class="form-control" id="exampleInputEmail1"
                        aria-describedby="emailHelp">
                </div>

                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Emp Id</label>
                    <input type="email" id="emp_id" readonly class="form-control" id="exampleInputEmail1"
                        aria-describedby="emailHelp">
                </div>

                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">User Type</label>

                    <select class="form-control" id="user_type" onchange="showPermissions()">
                        <option value="1">Admin</option>
                        <option value="2">Manager</option>
                    </select>
                </div>

                <div class="mb-3" id="permissions" style="display:none">
                    <label for="exampleInputEmail1" class="form-label">Select Permission</label>

                    <select id="permission" multiple data-style="bg-white rounded-pill px-4 py-3 shadow-sm "
                        class="selectpicker w-100">
                        {% for role in roles %}
                        <option value="{{role.id}}">{{role.role_name}}</option>
                        {% endfor %}
                    </select>
                </div>




            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" onclick="updateUser()" class="btn btn-primary">Update</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteUsers" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Delete users</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete users?
        </div>
        <div class="modal-footer">
          <button type="button" onclick="deleteUser()" class="btn btn-primary">Confirm</button>
        </div>
      </div>
    </div>
  </div>

<style>
    .chip {
        display: inline-flex;

        background-color: #e5e5e5;
        border: none;
        height: 25px;
        outline: none;
        padding: 0;
        font-size: 12px;
        color: #333333;
        font-family: "Open Sans", sans-serif;
        white-space: nowrap;
        border-radius: 16px;


    }

    .chip-content {
        cursor: inherit;
        display: flex;
        align-items: center;
        user-select: none;
        white-space: nowrap;
        padding-left: 12px;
        padding-right: 12px;
    }

    .bootstrap-select .bs-ok-default::after {
        width: 0.3em;
        height: 0.6em;
        border-width: 0 0.1em 0.1em 0;
        transform: rotate(45deg) translateY(0.5rem);
    }

    .btn.dropdown-toggle:focus {
        outline: none !important;
    }
</style>





{% endblock %}